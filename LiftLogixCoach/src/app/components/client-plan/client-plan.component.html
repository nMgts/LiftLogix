<app-back-arrow (goBack)="onGoBack()"></app-back-arrow>

<div class="component-container" *ngIf="choice===''">
  <div *ngIf="plan; else loading">
    <mat-card *ngIf="!notFound">
      <mat-card-header class="plan-header">
        <mat-card-title class="plan-name" [attr.title]="plan.name">{{ plan.name }}</mat-card-title>
      </mat-card-header>

      <mat-card-content class="plan-content">
        <p>Data rozpoczęcia: {{ plan.startDate | date:'dd.MM.yyyy' }}</p>
        <p>Długość: {{ getPlanDuration(plan.length) }}</p>
      </mat-card-content>
    </mat-card>

    <div class="actions" *ngIf="!notFound">
      <button mat-raised-button color="primary" (click)="viewPersonalPlan()">
        <span>Pogląd</span>
      </button>
      <button mat-raised-button color="accent" (click)="editPersonalPlan()">
        <span>Edytuj</span>
      </button>
      <button mat-raised-button color="accent" (click)="deactivatePersonalPlan()">
        <span>Zakończ</span>
      </button>
    </div>
  </div>

  <ng-template #loading>
    <p *ngIf="!notFound">Ładowanie planu...</p>
  </ng-template>

  <ng-container *ngIf="notFound && choice === ''">
    <mat-card>
      <mat-card-content>
        <div class="content">
          Obecnie klient nie ma przypisanego aktywnego planu. Możesz stworzyć nowy plan lub wybrać
          jeden z dostępnych w Twojej bibliotece. Wybierając istniejący plan, masz możliwość pozostawienia
          go bez zmian, ręcznej modyfikacji i automatycznego dostosowania.
        </div>
      </mat-card-content>
    </mat-card>

    <div class="actions">
      <button mat-raised-button color="primary" (click)="createNewPlan()">
        <span class="full-text">Stwórz nowy plan</span>
        <span class="short-text">Stwórz nowy</span>
      </button>
      <button mat-raised-button color="accent" (click)="selectExistingPlan()">
        <span class="full-text">Wybierz istniejący plan</span>
        <span class="short-text">Wybierz plan</span>
      </button>
    </div>
  </ng-container>

  <div class="plan-list-container" *ngIf="plans.length > 0 && choice === ''">
    <h1 class="title">Zakończone plany</h1>

    <div class="plan-list">
      <ng-container *ngFor="let plan of plans">
        <mat-card class="plan-card">
          <mat-card-title class="plan-name">
            <div class="name" [attr.title]="plan.name">{{ plan.name }}</div>
            <button mat-icon-button class="delete-button" (click)="deletePlan(plan.id)">
              <mat-icon class="delete-icon">delete</mat-icon>
            </button>
          </mat-card-title>

          <mat-card-content>
            <p>Data rozpoczęcia: {{ plan.startDate | date:'dd.MM.yyyy' }}</p>
            <p>Data zakończenia: {{ plan.endDate | date:'dd.MM.yyyy' }}</p>
          </mat-card-content>

          <div class="plan-actions">
            <button mat-raised-button color="primary" (click)="viewOldPlan(plan.id)">
              <mat-icon class="preview-icon">visibility</mat-icon>
              Podgląd
            </button>
          </div>
        </mat-card>
      </ng-container>
    </div>
  </div>
</div>

<div *ngIf="choice === 'create'">
  <app-workout-creator [isPersonalPlan]="true" [clientId]="clientId" [isFullScreen]="isFullScreen" (goBack)="onCancel()"></app-workout-creator>
</div>
<div *ngIf="choice === 'select'">
  <app-workout-library-private [personalPlan]="true" [clientId]="clientId" [isFullScreen]="isFullScreen" (goBack)="onCancel()"></app-workout-library-private>
</div>

<div *ngIf="choice === 'view' && plan">
  <app-workout-view [personalPlan]="plan" [isPersonalPlan]="true" [isFullScreen]="isFullScreen" (goBack)="onCancel()"></app-workout-view>
</div>

<div *ngIf="choice === 'viewOld' && selectedOldPlanId">
  <app-workout-view [oldPlanId]="selectedOldPlanId" [isPersonalPlan]="true" [isFullScreen]="isFullScreen" (goBack)="onCancel()"></app-workout-view>
</div>

<div *ngIf="choice === 'update' && plan">
  <app-workout-creator [personalPlan]="plan" [isPersonalPlan]="true" [isFullScreen]="isFullScreen" (goBack)="onCancel()"></app-workout-creator>
</div>
